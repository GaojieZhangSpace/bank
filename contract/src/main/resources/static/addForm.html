<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
<link rel="stylesheet" href="layui/css/layui.css" media="all" />
<script type="text/javascript" src="layui/layui.js"></script>
<script type="text/javascript" src="info.js"></script>
<title>添加合同信息</title>
</head>
<body>
<form id="addForm" class="layui-form" lay-filter="addForm" action="">
<div style="padding: 20px; background-color: #F2F2F2;">
  <div class="layui-row layui-col-space15">
     <fieldset class="layui-elem-field layui-field-title" style="margin-top: 0;">
      <legend>合同信息</legend>
    </fieldset>

	  <div class="layui-col-md12">
					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">合同号</label>
							<div class="layui-input-inline">
								<input id="cn" value='' type="text" name="cn" autocomplete="off"
									placeholder="请输入合同号" class="layui-input">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">创建日期</label>
							<div class="layui-input-inline">
								<input id="date" type="text" name="date" autocomplete="off"
									placeholder="yyyy" class="layui-input">
							</div>
						</div>
						<label class="layui-form-label">流借字</label>
						<div class="layui-input-inline">
							<input id="zi" type="text" name="zi" autocomplete="off"
								placeholder="请输入合同流借字" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">借款金额</label>
						<div class="layui-input-inline">
							<input id="debt" type="text" name="debt" autocomplete="off"
								placeholder="请输入借款金额" class="layui-input">
						</div>
						<label class="layui-form-label">币种</label>
						<div class="layui-input-inline">
							<select id="currency" name="currency"></select>
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">金额(大写)</label>
						<div class="layui-input-inline">
							<input id="bigFont" type="text" name="bigFont" autocomplete="off"
								placeholder="请输入大写金额" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">借款起始日</label>
							<div class="layui-input-inline">
								<input id="startDay" type="text" name="startDay"
									autocomplete="off" placeholder="yyyy-MM-dd" class="layui-input">
							</div>
						</div>

						<div class="layui-inline">
							<label class="layui-form-label">借款终止日</label>
							<div class="layui-input-inline">
								<input type="text" id="endDay" name="endDay" autocomplete="off"
									placeholder="yyyy-MM-dd" class="layui-input">
							</div>
						</div>
					</div>
				</div>

				<div class="layui-col-md12">
					<fieldset class="layui-elem-field layui-field-title"
						style="margin-top: 0;">
						<legend>借款人信息</legend>
					</fieldset>
					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">借款人</label>
							<div class="layui-input-inline">
								<input id="borrower"  type="text" name="borrower"
									autocomplete="off" placeholder="请输入借款人" class="layui-input">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">联系方式</label>
							<div class="layui-input-inline">
								<input id="bTel" type="text" name="bTel" autocomplete="off"
									placeholder="请输入联系方式" class="layui-input">
							</div>
						</div>
						
						<div class="layui-inline">
							<label class="layui-form-label">经营场所</label>
							<div class="layui-input-inline">
								<input id="bPlace" type="text" name="bPlace" autocomplete="off"
									placeholder="请输入经营场所" class="layui-input">
							</div>
						</div>
						<div id="cutCom">
						<div class="layui-inline">
							<label class="layui-form-label">法定代表</label>
							<div class="layui-input-inline">
								<input id="bAgent" type="text" name="bAgent" autocomplete="off"
									placeholder="请输入法定代表人" class="layui-input">
							</div>
						</div>
						</div>
						
						<div class="layui-inline">
							<label class="layui-form-label">借款方性质</label>
							<div class="layui-input-block">
								<input type="radio" name="bIsCom" id="company" value="1"  title="公司" lay-filter="company" checked>
							    <input type="radio" name="bIsCom" id="individual" value="0"  title="个人" lay-filter="individual">
							</div>
						</div>
						</div>
						
					<div class="layui-col-md12">
					<fieldset class="layui-elem-field layui-field-title"
						style="margin-top: 0;">
						<legend>放款人信息</legend>
					</fieldset>
					<div class="layui-form-item">
					<div class="layui-inline">
							<label class="layui-form-label">放款人</label>
							<div class="layui-input-inline">
								<input id="lender" value='' type="text" name="lender"
									autocomplete="off" placeholder="请输入放款人" class="layui-input">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">联系方式</label>
							<div class="layui-input-inline">
								<input id="lTel" type="text" name="lTel" autocomplete="off"
									placeholder="请输入联系方式" class="layui-input">
							</div>
						</div>
						
						<div class="layui-inline">
							<label class="layui-form-label">经营场所</label>
							<div class="layui-input-inline">
								<input id="lPlace" type="text" name="lPlace" autocomplete="off"
									placeholder="请输入经营场所" class="layui-input">
							</div>
						</div>
						<div id="cutBank">
						<div class="layui-inline">
							<label class="layui-form-label">法定代表</label>
							<div class="layui-input-inline">
								<input id="lAgent" type="text" name="lAgent" autocomplete="off"
									placeholder="请输入法定代表人" class="layui-input">
							</div>
						</div>
						</div>
						
						<div class="layui-inline">
							<label class="layui-form-label">放款方性质</label>
							<div class="layui-input-block">
								<input type="radio" name="lIsCom" id="lcompany" value="1"  title="公司" lay-filter="lcompany" checked>
							    <input type="radio" name="lIsCom" id="lindividual" value="0"  title="个人" lay-filter="lindividual">
							</div>
						</div>
						
					</div>
					</div>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<button type="submit" class="layui-btn" lay-submit="" lay-filter="infoSub">提交</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							</div>
						</div>
					</div>

<script>
layui.use(['form','layer'],function(){
    	var form = layui.form
    	  ,layer = layui.layer;
   
    form.on('radio(company)',function(){
     	$('#cutCom').show();
    });
    
    form.on('radio(individual)',function(){
    	$('#bAgent').val("");
     	$('#cutCom').hide();
    });
    
    form.on('radio(lcompany)',function(){
    	$('#cutBank').show();
    });
    form.on('radio(lindividual)',function(){
    	$('#lAgent').val("");
    	$('#cutBank').hide();
    });

   $('#debt').bind("input propertychang",function(event){
	   var m=this.value;
	   $('#bigFont').val(numberParseChina(m));
   });
   
        layui.use('laydate', function(){
        	  var laydate = layui.laydate;
        	  
        	  //执行一个laydate实例
        	  laydate.render({
        	    elem: '#date' //指定元素
        	   ,type: 'year'
        	   ,trigger: 'click'
        	  });
        	  
        	  laydate.render({
        		  elem: '#startDay'
        		 ,type: 'date'
        		 ,trigger: 'click'
        	  });
        	  
        	  laydate.render({
        		  elem: '#endDay'
        		 ,type: 'date'
        	     ,trigger: 'click'
        	  })
        	});

        var url="http://localhost:8008/info/getAllCurr";
        $.get(url, function (data) {
            if (data.code == 0) {
                for (var i = 0; i < data.data.length; i++) {
                       var newRow = "<option value=" + data.data[i].c_id + ">" + data.data[i].c_name + "</option>";
                    $("#currency").append(newRow);
                }
                form.render();
            }
        });
        
        //提交
        form.on('submit(infoSub)', function(data){
        	  var data = form.val('addForm');
        	 var url = "http://localhost:8008/info/addInfo?cn=" + data.cn + "&date=" + data.date + "&zi=" + data.zi + "&debt=" + data.debt + "&currency=" + data.currency + "&borrower=" + data.borrower + "&lender="+ data.lender + "&startDay=" + data.startDay + "&endDay=" + data.endDay +"&bPlace=" + data.bPlace + "&lPlace=" + data.lPlace +"&bTel=" + data.bTel+"&lTel=" + data.lTel +"&bAgent=" + data.bAgent + "&lAgent=" + data.lAgent +"&bIsCom=" + data.bIsCom +"&lIsCom="+data.lIsCom 	 
             $.get(url, function (data) {
                 if (data.code == 0) {
                	 window.parent.location.reload();
                 } else {
                     alert(data.msg);
                 }
             });
          return false;
        });
    });
    
    //阿拉伯数字转换成大写汉字
    function numberParseChina(money){
    //汉字的数字
      var cnNums = new Array('零', '壹', '贰', '叁', '肆', '伍', '陆', '柒', '捌', '玖');
      //基本单位
      var cnIntRadice = new Array('', '拾', '佰', '仟');
      //对应整数部分扩展单位
      var cnIntUnits = new Array('', '万', '亿', '兆');
      //对应小数部分单位
      var cnDecUnits = new Array('角', '分', '毫', '厘');
      //整数金额时后面跟的字符
      var cnInteger = '整';
      //整型完以后的单位
      var cnIntLast = '圆';
      //最大处理的数字
      var maxNum = 999999999999999.9999;
      //金额整数部分
      var integerNum;
      //金额小数部分
      var decimalNum;
      //输出的中文金额字符串
      var chineseStr = '';
      //分离金额后用的数组，预定义
      var parts;
      if (money == '') { return ''; }
      money = parseFloat(money);
      if (money >= maxNum) {
        //超出最大处理数字
        return '';
      }
      if (money == 0) {
        chineseStr = cnNums[0] + cnIntLast + cnInteger;
        return chineseStr;
      }
      //转换为字符串
      money = money.toString();
      if (money.indexOf('.') == -1) {
        integerNum = money;
        decimalNum = '';
      } else {
        parts = money.split('.');
        integerNum = parts[0];
        decimalNum = parts[1].substr(0, 4);
      }
      //获取整型部分转换
      if (parseInt(integerNum, 10) > 0) {
        var zeroCount = 0;
        var IntLen = integerNum.length;
        for (var i = 0; i < IntLen; i++) {
          var n = integerNum.substr(i, 1);
          var p = IntLen - i - 1;
          var q = p / 4;
          var m = p % 4;
          if (n == '0') {
            zeroCount++;
          } else {
            if (zeroCount > 0) {
              chineseStr += cnNums[0];
            }
            //归零
            zeroCount = 0;
            chineseStr += cnNums[parseInt(n)] + cnIntRadice[m];
          }
          if (m == 0 && zeroCount < 4) {
            chineseStr += cnIntUnits[q];
          }
        }
        chineseStr += cnIntLast;
      }
      //小数部分
      if (decimalNum != '') {
        var decLen = decimalNum.length;
        for (var i = 0; i < decLen; i++) {
          var n = decimalNum.substr(i, 1);
          if (n != '0') {
            chineseStr += cnNums[Number(n)] + cnDecUnits[i];
          }
        }
      }
      if (chineseStr == '') {
        chineseStr += cnNums[0] + cnIntLast + cnInteger;
      } else if (decimalNum == '') {
        chineseStr += cnInteger;
      }
      return chineseStr;
    }
    
   
 
    
</script>	
 </div>
</div>
  </form>
</body>
</html>